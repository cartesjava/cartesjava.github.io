{{- define "render_shortcode" -}}{{ $params := . }}{{ $shortcode := $params.Get "shortcode" }}{{ $beforeOpenning := findRE "^([^{]|[^{][^{]|[^{][^{][^%])*{{%" $shortcode }}{{ if $beforeOpenning }}{{ $beforeOpenning = index $beforeOpenning 0 }}{{ $beforeOpenning = replace $beforeOpenning "{{%" "" }}{{ $shortcode = replace $shortcode $beforeOpenning "" }}{{ $beforeOpenning | safeHTML }}{{ end }}{{ $shortcode_name := findRE "{{%[ ]+[^ ]+[ ]" $shortcode }}{{ $shortcode_name = trim (replace (index $shortcode_name 0) "{{%" "") "  " }}{{ $rawArgs := findRE "\"([^\"]+)\"" $shortcode }}{{ warnf "rawArgs: %s" $rawArgs }}{{ $args := $rawArgs }}{{ if eq $shortcode_name "embed" }}{{ $src := trim (index $args 0) "\"\"" }}{{ $first_line := trim (index $args 1) "\"\"" }}{{ $last_line := trim (index $args 2) "\"\"" }}{{ $params.Set "src" $src }}{{ $params.Set "first_line" $first_line }}{{ $params.Set "last_line" $last_line }}{{ template "embed" $params }}{{ else if eq $shortcode_name "video" }}{{ template "apply_video_shortcode" $params }}{{ else if or (eq $shortcode_name "link") (eq $shortcode_name "download") }}{{ $src := trim (index $args 0) "\"\"" }}{{ $text := trim (index $args 1) "\"\"" }}{{ $download := false }}{{ if eq $shortcode_name "download" }}{{ $download = true }}{{ end }}{{ $params.Set "src" $src }}{{ $params.Set "text" $text }}{{ $params.Set "download" $download }}{{ template "link" $params }}{{ else if eq $shortcode_name "summary" }}{{ $text := trim (index $args 0) "\"\"" }}{{ $params.Set "text" $text }}{{ template "summary" $params }}{{ end }}{{- end -}}