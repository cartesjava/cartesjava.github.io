{{- define "node" -}}{{ $params := . }}{{ $src := .Get "src" }}{{ $data := .Get "data" }}{{ $keys := split $src "." }}{{ range $key := $keys }}{{ $data = index $data $key }}{{ end }}{{ if $data }}{{ if and ($data.title) (not (eq ($data.title "" ))) }}{{ printf "# %s\n" $data.title | markdownify | safeHTML }}{{ end }}{{ if $data.summary }}{{ printf "<div>" | safeHTML }}{{ printf "%s" $data.summary | markdownify | safeHTML }}{{ printf "</div>" | safeHTML }}{{ end }}{{ if $data.children }}{{ range $child := $data.children }}{{ if reflect.IsMap $child }}{{ if $child.title }}{{ printf "# %s\n" $child.title | markdownify | safeHTML }}{{ end }}{{ else }}{{ $lines := split $child "\n" }}{{ $firstLine := index $lines 0 }}{{ if and (eq (len $lines) 1) (findRE "^[[:space:]]*[[:word:]]+([.][[:word:]]+)*$" $firstLine) }}{{ $params.Set "src" $child }}{{ template "node" $params }}{{ else }}{{ printf "%s\n" $child | markdownify | safeHTML }}{{ end }}{{ end }}{{ end }}{{ end }}{{ else }}{{ printf "%s\n" $src | markdownify | safeHTML }}{{ end }}{{- end -}}